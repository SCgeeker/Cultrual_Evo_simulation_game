<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文化演化賽局</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app">
        <header>
            <h1>文化演化賽局</h1>
            <p class="subtitle" id="game-phase">遊戲設置</p>
        </header>

        <main>
            <!-- 設定畫面 -->
            <section id="screen-setup">
                <div class="setup-form">
                    <label>玩家人數</label>
                    <select id="player-count">
                        <option value="1">1 人（練習）</option>
                        <option value="2">2 人（練習）</option>
                        <option value="3" selected>3 人</option>
                        <option value="4">4 人</option>
                        <option value="5">5 人</option>
                    </select>
                </div>
                <div class="setup-form">
                    <label>最大回合數</label>
                    <input type="number" id="max-rounds" value="20">
                </div>
                <div class="setup-form">
                    <label>勝利目標 (CCS)</label>
                    <input type="number" id="target-ccs" value="30" placeholder="預設 30">
                </div>
                <div class="setup-form">
                    <label>每回合基礎能量</label>
                    <input type="number" id="base-energy" value="10" min="1" max="20">
                </div>
                <div class="setup-form">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="require-guts" style="width: auto;">
                        強制消化投資 (最少 3 點才能存活)
                    </label>
                </div>
                <div id="player-names"></div>
                <button id="start-btn" class="btn-primary">開始遊戲</button>
            </section>

            <!-- 事件畫面 -->
            <section id="screen-event" class="hidden">
                <div class="event-box">
                    <p class="event-round">第 <span id="event-round">1</span> 回合</p>
                    <div class="event-icon" id="event-icon">🌵</div>
                    <h2 id="event-name">乾季來臨</h2>
                    <p class="event-desc" id="event-desc">消化回報 ×1.5</p>
                    <button id="event-continue-btn" class="btn-primary">繼續</button>
                </div>
            </section>

            <!-- 交接畫面 -->
            <section id="screen-handover" class="hidden">
                <div class="handover-box">
                    <p>請將裝置交給</p>
                    <h2 id="next-player-name">部落 1</h2>
                    <button id="ready-btn" class="btn-primary">我準備好了</button>
                </div>
            </section>

            <!-- 投資畫面 -->
            <section id="screen-invest" class="hidden">
                <div class="current-player-info">
                    <span id="current-player-label">部落 1</span>
                    <span>第 <strong id="round-number">1</strong> 回合</span>
                </div>

                <div class="energy-info">
                    <span>可用能量: <strong id="total-energy">10</strong></span>
                    <span>保留: <strong id="reserved-energy">10</strong></span>
                </div>

                <!-- 作用中的技術效果 -->
                <div id="active-bonuses" class="active-bonuses hidden">
                    <h3>已啟用的技術效果:</h3>
                    <ul id="active-bonuses-list"></ul>
                </div>

                <div class="investment-area" data-type="brain">
                    <h2>發展大腦 <span class="multiplier-badge hidden" id="mult-brain">×1.5</span></h2>
                    <p class="cost-hint">每 2 能量 = 1 技術點 AP (累積智慧)</p>
                    <div class="slider-row">
                        <input type="range" id="slider-brain" min="0" max="10" value="0">
                        <span class="slider-value" id="value-brain">0</span>
                    </div>
                    <p class="reward-preview">→ 預估 AP: <strong id="reward-brain">0</strong></p>
                </div>

                <div class="investment-area" data-type="guts">
                    <h2>維護消化 <span class="multiplier-badge hidden" id="mult-guts">×1.5</span></h2>
                    <p class="cost-hint">每 3 能量 = +2 下回合能量</p>
                    <div class="slider-row">
                        <input type="range" id="slider-guts" min="0" max="10" value="0">
                        <span class="slider-value" id="value-guts">0</span>
                    </div>
                    <p class="reward-preview">→ 預估能量: <strong id="reward-guts">+0</strong></p>
                </div>

                <div class="investment-area" data-type="muscle">
                    <h2>強化肌肉 <span class="multiplier-badge hidden" id="mult-muscle">×1.5</span></h2>
                    <p class="cost-hint">每 2 能量 = 1 行動點 (短期優勢)</p>
                    <div class="slider-row">
                        <input type="range" id="slider-muscle" min="0" max="10" value="0">
                        <span class="slider-value" id="value-muscle">0</span>
                    </div>
                    <p class="reward-preview">→ 預估行動: <strong id="reward-muscle">0</strong></p>
                    <p class="total-forecast">下回合總能量預估: <strong id="forecast-total">10</strong></p>
                </div>

                <div id="warning" class="warning hidden">超出預算！請減少投資。</div>
                <button id="confirm-btn" class="btn-primary">確認投資</button>
            </section>

            <!-- 行動決策畫面 (多人) -->
            <section id="screen-action" class="hidden">
                <div class="action-box">
                    <p class="subtitle">行動階段 (未使用的 AP 將保留)</p>
                    <h2 id="action-player-name">部落 1</h2>

                    <div class="ap-display">
                        <div class="ap-item">智慧點 (AP): <strong id="current-ap">0</strong> <span
                                class="hint">(用於技術樹)</span></div>
                        <div class="ap-item">行動點: <strong id="current-action-points">0</strong> <span
                                class="hint">(用於此階段)</span></div>
                    </div>

                    <!-- 頁籤切換 -->
                    <div class="action-tabs">
                        <button class="tab-btn active" data-tab="actions">⚔️ 行動</button>
                        <button class="tab-btn" data-tab="tech-tree">🧬 技術升級</button>
                    </div>

                    <!-- 行動選項頁籤 -->
                    <div class="tab-content active" id="tab-actions">
                        <div class="action-options">
                            <div class="action-card" id="btn-hunt">
                                <div class="icon">🏹</div>
                                <h3>狩獵</h3>
                                <p>消耗 1 AP</p>
                                <p class="effect">獲得 +1 能量</p>
                            </div>

                            <div class="action-card" id="btn-defend">
                                <div class="icon">🛡️</div>
                                <h3>防禦</h3>
                                <p>消耗 1 AP</p>
                                <p class="effect">抵消 1 次掠奪</p>
                            </div>

                            <div class="action-card disabled" id="group-plunder">
                                <div class="icon">⚔️</div>
                                <h3>掠奪</h3>
                                <p>消耗 1 AP</p>
                                <p class="effect">搶奪對手 2 能量</p>
                                <div id="plunder-targets" class="target-list">
                                    <!-- 動態生成對手按鈕 -->
                                </div>
                            </div>
                        </div>
                    </div><!-- 結束 tab-actions -->

                    <!-- 技術樹頁籤 -->
                    <div class="tab-content" id="tab-tech-tree">
                        <div class="tech-tree-panel">
                            <p class="tech-tree-hint">消耗 AP 解鎖技術，獲得永久效果</p>
                            <div class="tech-paths" id="tech-paths-container">
                                <!-- 動態生成四條技術路徑 -->
                            </div>
                        </div>
                    </div><!-- 結束 tab-tech-tree -->

                    <button id="reset-action-btn" class="btn-secondary">重置分配</button>
                    <button id="end-action-btn" class="btn-primary">確認行動</button>
                </div>
            </section>

            <!-- 技術卡詳情彈窗 -->
            <div id="tech-modal" class="modal hidden">
                <div class="modal-content tech-modal-content">
                    <div class="tech-modal-header">
                        <span class="tech-modal-icon" id="modal-tech-icon">🔥</span>
                        <div class="tech-modal-title-area">
                            <h2 id="modal-tech-name">火的控制</h2>
                            <span class="tech-modal-path" id="modal-tech-path">外部消化路線</span>
                        </div>
                        <button class="modal-close" id="modal-close-btn">&times;</button>
                    </div>
                    <div class="tech-modal-body">
                        <p class="tech-description" id="modal-tech-desc">掌握火焰，開啟人類演化的關鍵一步</p>
                        <p class="tech-flavor" id="modal-tech-flavor">火讓我們能在夜間活動...</p>
                        <div class="tech-effects" id="modal-tech-effects">
                            <!-- 動態生成效果列表 -->
                        </div>
                        <div class="tech-requirements" id="modal-tech-requirements">
                            <!-- 動態生成前置需求 -->
                        </div>
                    </div>
                    <div class="tech-modal-footer">
                        <div class="tech-cost">
                            <span>升級成本:</span>
                            <strong id="modal-tech-cost">2 AP</strong>
                        </div>
                        <button id="modal-unlock-btn" class="btn-primary">解鎖技術</button>
                    </div>
                </div>
            </div>

            <!-- 行動說明畫面 (單人練習) -->
            <section id="screen-action-info" class="hidden">
                <div class="action-box">
                    <h2>行動點數 (Muscle)</h2>
                    <p class="desc-text">
                        您獲得了 <strong id="info-ap">0</strong> 點行動點。<br><br>
                        在多人模式中，您可以消耗行動點來：<br>
                        1. <strong>狩獵/農耕</strong>：獲得額外能量。<br>
                        2. <strong>掠奪</strong>：搶奪其他玩家的能量。<br>
                        3. <strong>防禦</strong>：保護自己免受搶奪。
                    </p>
                    <button id="info-confirm-btn" class="btn-primary">了解</button>
                </div>
            </section>

            <!-- 個人結果畫面 -->
            <section id="screen-personal-result" class="hidden">
                <div class="personal-result-box">
                    <h2 id="personal-player-name">部落 1</h2>
                    <p class="subtitle">投資結果</p>
                    <ul class="personal-result-list">
                        <li>發展大腦 (AP): <strong id="personal-brain">0</strong> → 獲得 <strong id="personal-ap">0</strong>
                            智慧點</li>
                        <li>維護消化 (能量): <strong id="personal-guts">0</strong> → 產出 <strong
                                id="personal-energy">+0</strong> 能量</li>
                        <li>強化肌肉 (行動): <strong id="personal-muscle">0</strong> → 獲得 <strong
                                id="personal-actions">0</strong> 行動點</li>
                        <li>當前文化複雜度 (CCS): <strong id="personal-cards">0</strong></li>
                        <li>本回合保留能量: <strong id="personal-reserved">0</strong></li>
                        <li class="potential-item">下一階段潛在行動收益: <strong id="personal-potentials">+0</strong> 能量</li>
                        <li class="final-energy-item">下回合起始能量 (預期): <strong id="personal-final-next">0</strong></li>
                    </ul>
                    <button id="next-player-btn" class="btn-primary">交給下一位</button>
                </div>
            </section>

            <!-- 結算畫面 -->
            <section id="screen-result" class="hidden">
                <h2>第 <span id="result-round">1</span> 回合結算</h2>
                <div class="result-table-wrapper">
                    <table id="result-table">
                        <thead>
                            <tr>
                                <th>部落</th>
                                <th>大腦 (AP)</th>
                                <th>消化 (⚡)</th>
                                <th>肌肉 (⚔️)</th>
                                <th>文化 (CCS)</th>
                                <th>收益 (⚡)</th>
                                <th>保留 (⚡)</th>
                                <th>下回合 (⚡)</th>
                            </tr>
                        </thead>
                        <tbody id="result-body"></tbody>
                    </table>
                </div>
                <button id="next-round-btn" class="btn-primary">下一回合</button>
            </section>

            <!-- 遊戲結束畫面 -->
            <section id="screen-game-over" class="hidden">
                <div class="game-over-box">
                    <div class="trophy">🏆</div>
                    <p class="subtitle">文化演化最終王者</p>
                    <h2 id="winner-name">部落 1</h2>
                    <p class="winner-stat">文化複雜度 (CCS): <strong id="winner-score">0</strong></p>

                    <div class="result-table-wrapper">
                        <table id="final-rank-table">
                            <thead>
                                <tr>
                                    <th>排名</th>
                                    <th>部落</th>
                                    <th>文化度 (CCS)</th>
                                    <th>當前能量</th>
                                    <th>總技術數</th>
                                </tr>
                            </thead>
                            <tbody id="final-rank-body"></tbody>
                        </table>
                    </div>

                    <div class="action-buttons">
                        <button id="restart-btn" class="btn-primary">重新開始</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="app.js"></script>
</body>

</html>