# 技術卡系統開發計畫 (AP 統一資源版)

> 更新日期：2026-01-21
> 狀態：**Phase 1-2 已完成，待討論資源機制**
> 理論基礎：《The Secret of Our Success》、《The WEIRDest People in the World》

---

## 一、核心設計變更：AP 統一資源化

為了降低開發難度並提升玩家體驗，我們將 **AP (行動點數)** 設定為遊戲的核心動態資源。

### 1.1 資源權衡 (Opportunity Cost)

- **獲取**：透過「大腦投資」獲得 AP。
- **消耗**：
  - **行動 (Action)**：採集、狩獵、防禦、掠奪、農耕等。
  - **深化 (Upgrade)**：解鎖技術路徑（Tech Tree）。
- **策略重點**：玩家必須在「立即的生存/擴張（行動）」與「長期的發展效率（升級）」之間做出選擇。

### 1.2 升級機制

- 移除原本規劃的「知識點」。
- AP 可跨回合累積，允許玩家為昂貴的高級技術進行「儲蓄」。

---

## 二、技術路徑設計 (AP 成本)

### 2.1 四條主路徑

#### 路徑 A：外部消化路線 🔥

| 技術 | 成本 (AP) | 效果 | 解鎖行動 |
|------|----------|------|---------|
| 火的控制 | 2 | 消化-20%，大腦+10% | - |
| 烹飪技術 | 3 | 消化再-30%，能量上限+3 | - |
| 食物保存 | 5 | 無限儲能，消化需求歸零 | **農耕** |
| 人造物系統 | 8 | 每回合+5能量，肌肉成本減半 | - |

#### 路徑 B：工具製作路線 🪨

| 技術 | 成本 (AP) | 效果 | 解鎖行動 |
|------|----------|------|---------|
| 石器製作 | 2 | 每回合免費+1肌肉投資點 | - |
| 長矛狩獵 | 3 | 狩獵行動額外+1能量 | 強化狩獵 |
| 複雜工具 | 5 | 所有投資報酬+20% | - |
| 人造物系統 | 8 | (與路徑A共同終點) | - |

#### 路徑 C：社會學習路線 🗣️

| 技術 | 成本 (AP) | 效果 | 解鎖行動 |
|------|----------|------|---------|
| 語言 Lv.1 | 2 | 可查看一位玩家的投資分配 | - |
| 族群認同 | 3 | 可與一位玩家結盟 | **掠奪、防禦、結盟** |
| 口語傳承 | 5 | 技術卡效果+50% | - |
| 社會規範 | 5 | 額外分支 | **懲罰** |
| 教學系統 | 8 | 可複製對手的技術卡效果 | - |

#### 路徑 D：環境知識路線 🌿

| 技術 | 成本 (AP) | 效果 | 解鎖行動 |
|------|----------|------|---------|
| 採集知識 | 2 | 消化投資報酬+20% | - |
| 民俗生物學 | 3 | 環境事件可查看並重抽 | **探索** |
| 環境適應 | 5 | 負面環境事件無效 | - |
| 資訊資源 | 8 | 每回合額外+2知識點 (轉化為AP) | - |

---

## 三、程式碼架構規劃

### 3.1 UpgradeManager 整合

```javascript
const UpgradeManager = {
    // 檢查 AP 是否足夠升級
    canUpgrade(player, pathId) {
        const nextTech = this.getNextTech(player, pathId);
        return player.currentAP >= nextTech.upgradeCost;
    },
    // 執行升級並扣除 AP
    upgrade(player, pathId) {
        if (!this.canUpgrade(player, pathId)) return;
        const tech = this.performUpgrade(player, pathId);
        player.currentAP -= tech.upgradeCost;
        TechTreeManager.applyTechEffects(player, tech);
    }
};
```

---

## 四、開發階段規劃

### Phase 1：資料與基礎邏輯重構 ✅ 已完成 (2026-01-21)

- [x] 移除舊有的 `drawTechCards` 隨機抽卡邏輯。
- [x] 定義 `TECH_PATHS` 與 `TECH_CARDS` 常數（AP 成本制）。
- [x] 重構 `player` 物件，確保 AP 可累積。
- [x] 新增 `TechTreeManager` 管理升級邏輯。

### Phase 2：技術樹 UI 實作 ✅ 已完成 (2026-01-21)

- [x] 在「行動階段」畫面新增「技術路徑」面板。
- [x] 實作頁籤切換（行動 / 技術升級）。
- [x] 實作升級按鈕與 AP 扣除視覺反饋。
- [x] 實作技術卡詳情彈窗。
- [x] 新增 `TechTreeUI` 管理介面渲染。

### Phase 3：效果與行動解鎖 ⏸️ 暫停

- [ ] 實作各路徑技術的數值乘數效果。
- [ ] 動態更新行動清單（例如：有「族群認同」才顯示掠奪）。
- [ ] 實作「農耕」等解鎖行動的邏輯。

### Phase 4：平衡測試

- [ ] 測試 AP 獲取速度與升級成本的比例。
- [ ] 測試單人 vs 多人模式下的技術選擇策略。

---

## 五、待討論：能量轉換機制設計衝突 ⚠️

### 5.1 問題描述

目前計畫書（1.1 節）規定「透過**大腦投資**獲得 AP」，但程式碼實作是：

| 投資類型 | 計畫書規劃 | 目前實作 |
| -------- | ---------- | -------- |
| 大腦 | → AP | → 文化成就分數 (cards) |
| 消化 | → 能量 | → 能量 ✅ |
| 肌肉 | → ? | → AP |

### 5.2 待決定

1. **AP 來源**：應該由大腦還是肌肉投資產出？
2. **三軌道產出**：
   - 大腦：AP？文化成就？還是兩者皆有？
   - 肌肉：AP？防禦點？戰鬥力？
3. **勝利條件**：文化成就分數 (totalCards) 的角色是什麼？

### 5.3 設計方案選項

#### 方案 A：按計畫修改

- 大腦 → AP（用於行動 + 技術升級）
- 肌肉 → 防禦點或戰鬥效益
- 優點：符合「大腦帶來智慧」的主題

#### 方案 B：維持現狀

- 大腦 → 文化成就（計分）
- 肌肉 → AP
- 優點：不需大改程式碼

#### 方案 C：混合設計

- 大腦 → AP + 文化成就（雙產出）
- 肌肉 → 基礎行動點（只能用於行動，不能升級）
- 優點：區分「行動力」與「學習力」
